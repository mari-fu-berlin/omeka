/*
 *  Item-Relations-Autocomplete - v1.0.0
 *  Autocomplete for Omeka ItemRelations Plugin
 *
 *  Made by Viktor Grandgeorg
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="itemrelationsAutocomplete",g={adminBaseUrl:"/admin",warnNoItemFound:"Kein passendes Objekt gefunden!"};a.extend(e.prototype,{init:function(){var b=a(".ui-widget input",a(this.element).last());this.setAutocomplete(b),this.setAddRow()},setAutocomplete:function(b){var c=this.settings;b.autocomplete({source:"/admin/gina-admin-mod/item-autocomplete?type=27",minLength:1,select:function(d,e){a(".selected-autocomplete",b.parent()).html('<a href="'+c.adminBaseUrl+"/items/show/"+e.item.value+'" target="_blank">'+e.item.label+"</a>").show("fade",{},500)}}),a(b).on("autocompleteresponse",function(d,e){0===e.content.length&&a.getJSON(c.adminBaseUrl+"/gina-admin-mod/item-autocomplete-id/"+b.val(),function(d){d.hasOwnProperty("status")?200===d.status?a(".selected-autocomplete",b.parent()).html('<a href="'+c.adminBaseUrl+"/items/show/"+d.id+'" target="_blank">'+d.sigle+"</a>").show("fade",{},500):a(".selected-autocomplete",b.parent()).html('<div class="warn">'+c.warnNoItemFound+"</div>").show("fade",{},500):a(".selected-autocomplete",b.parent()).html("").hide("fade",{},500)})})},setAddRow:function(){var b=this;a(".item-relations-add-relation").click(function(){var c=a(".item-relations-entry").last(),d=c.clone();c.after(d);var e=a(".ui-widget input",d),f=d.find("select");e.val(""),f.val(""),a(".selected-autocomplete",d).html("").hide(),b.setAutocomplete(e)})}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);