/*
 *  Item-Relations-Autocomplete - v1.0.0
 *  Autocomplete for Omeka ItemRelations Plugin
 *
 *  Made by Viktor Grandgeorg
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="itemrelationsAutocomplete",g={adminBaseUrl:"/admin",warnNoItemFound:"Kein passendes Objekt gefunden!"};a.extend(e.prototype,{init:function(){this.bindItemRelations(),this.setAddRow()},bindItemRelations:function(){var b=this;a(".item-relations-entry",this.element).each(function(){var c=a(".ui-widget input",a(this).last());b.setAutocomplete(c)})},setAutocomplete:function(b){var c=this.settings;b.autocomplete({source:"/admin/gina-admin-mod/item-autocomplete?type=27",minLength:1,select:function(d,e){a(".selected-autocomplete",b.parent()).html('<a href="'+c.adminBaseUrl+"/items/show/"+e.item.value+'" target="_blank">'+e.item.label+"</a>").show("fade",{},500)}}),a(b).on("autocompleteresponse",function(d,e){0===e.content.length&&a.getJSON(c.adminBaseUrl+"/gina-admin-mod/item-autocomplete-id/"+b.val(),function(d){d.hasOwnProperty("status")?200===d.status?a(".selected-autocomplete",b.parent()).html('<a href="'+c.adminBaseUrl+"/items/show/"+d.id+'" target="_blank">'+d.sigle+"</a>").show("fade",{},500):a(".selected-autocomplete",b.parent()).html('<div class="warn">'+c.warnNoItemFound+"</div>").show("fade",{},500):a(".selected-autocomplete",b.parent()).html("").hide("fade",{},500)})})},setAddRow:function(){var b=this;a("#item-relations-add-relation").click(function(){var c=a(".item-relations-new-entry").last(),d=a(".item-relations-entry-annotation").last(),e=c.clone(),f=a("textarea",d).attr("name").match(/\[(\d+)\]/),g="item_relations_new_annotation["+(parseInt(f[1])+1)+"]",h=a('<tr class="item-relations-entry-annotation"><td colspan="4"><label for="'+g+'" style="margin-bottom: 8px; display: block;">Annotationen</label><textarea name="'+g+'" id="'+g+'" style="width:100%;"></textarea></td></tr>');e.insertAfter(d),h.insertAfter(e);var i=a(".ui-widget input",e),j=e.find("select");i.val(""),j.val(""),a(".selected-autocomplete",e).html("").hide(),b.setAutocomplete(i),tinyMCE.execCommand("mceAddControl",!0,g)})}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);