/*
 *  Item-Sigle-Autocomplete - v1.0.0
 *  Autocomplete for Omeka items' sigle elements
 *
 *  Made by Viktor Grandgeorg
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="autocompleteSigle",g={adminBaseUrl:"/admin",warnNoItemFound:"Kein passendes Objekt gefunden!",itemType:27};a.extend(e.prototype,{init:function(){this.formatAutocompletefield(this.element),this.formatAutofield(this.settings.autofield),this.setAutocomplete()},formatAutofield:function(b){var c=a(b),d=a("textarea",c),e=d.attr("name"),f=d.attr("id");this.settings.autoFieldCurrentId=f;var g=d.val();c.addClass("gina-element-read-only"),d.remove();var h=a(".input",c).append('<input type="hidden" name="'+e+'" id="'+f+'" class="readonly" readonly>');a("#"+f,h).val(g),a(".input",c).append('<a href="'+this.settings.adminBaseUrl+"/items/show/"+g+'" id="link-'+f+'" target="_blank">ID: '+g+"</a>")},formatAutocompletefield:function(b){var c=a(b),d=a("textarea",c),e=d.attr("name"),f=d.attr("id");this.settings.autocompleteFieldCurrentId=f;var g=d.val();c.addClass("gina-element-read-only"),d.remove();var h=a(".input",c).append('<input type="text" name="'+e+'" id="'+f+'">');a("#"+f,h).val(g)},setAutocomplete:function(){var b=this.settings,c=a("#"+this.settings.autocompleteFieldCurrentId,this.element),d=c.val();a.widget("custom.catcomplete",a.ui.autocomplete,{_create:function(){this._super(),this.widget().menu("option","items","> :not(.ui-autocomplete-category)")},_renderMenu:function(b,c){var d=this,e="";a.each(c,function(a,c){var f;c.category!==e&&(b.append('<li class="ui-autocomplete-category">'+c.category+"</li>"),e=c.category),f=d._renderItemData(b,c),c.category&&f.attr("aria-label",c.category+" : "+c.label)})}}),c.catcomplete({source:"/admin/gina-admin-mod/item-autocomplete-complex?type="+b.itemType,minLength:1,select:function(c,d){a("#"+b.autoFieldCurrentId).val(d.item.item_id),a("#link-"+b.autoFieldCurrentId).attr("href",b.adminBaseUrl+"/items/show/"+d.item.item_id).html("ID: "+d.item.item_id)},change:function(b,c){c.item||a(b.target).val(d)},focus:function(){return!1}})}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);